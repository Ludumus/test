# WBA Analytics - Техническое задание - Архитектура тейлов

### <span style="color:darkgreen;">Интро</span>

В момент первого взаимодействия пользователя с товаром (когда пользователь впервые видит товар в выдаче или переходит к карточке товара) можно собрать определенную информацию о товаре или выдаче, которая понадобится при анализе e-commerce событий

Информацию о товаре или выдаче товаров, которая должна быть сохранена и включена в e-commerce события, мы называем “tail”. Специфические атрибуты мы называем “terms”

**Структура “tail” выглядит следующим образом:**

```json
"tail_object":
{ 
    "location": "название локации", // string
    "index": "позиция товара в выдаче", // number
    "platform": "название платформы, на которой сформирован tail", // string
    "terms": 
       {
          "название_терма_1": "значение терма 1", // string
          "название_терма_2": "значение терма 2" // string
       }
}
```

**Пример:**
Пользователь ввел поисковый запрос “iPhone 12 Pro”, приложение на iOS вернуло список из 8-ми товаров. В этом случае для 4-го товара в списке мы ожидаем следующий tail:

```json
"tail_object":
{ 
    "location": "XXXX", // информация о том, что выдача товаров была сформирована поиском
    "index": 4, // позиция товара в выдаче 
    "platform": "iOS", // платформа, на которой товар был показан
    "terms": {
       "search_type": "text", // информация о том, что был введен обычный поисковый запрос
       "text": "iPhone 12 Pro" // текст обычного поискового запроса
            }
}
```

### <span style="color:darkgreen;">Дополнительная информация</span>

* Tail присваивается в момент первого взаимодействия пользователя с товаром и передается во все e-commerce события
* Tail передается в качестве атрибута товара в объектах: “items” (для приложений), “products” (для web)
* Количество terms может регулярно увеличиваться (Например, может появиться необходимость логировать дополнительный term, который будет содержать в себе список предложенных пользователю поисковых запросов)
* Структура tail_object может меняться. Например, может быть добавлен дополнительный объект
* При добавлении товара в корзину или избранное, tail должен сохраняться в сервисе синхронизации
* Нет необходимости хранить tail после того, как пользователь оформил заказ или удалил товар из корзины/избранного
* Корзина и избранное являются зонами, где сохранен tail изначальной выдачи товаров, откуда пользователь добавил себе этот товар. Корзина и избранное не являются выдачами товаров и не имеют выделенного tail

### <span style="color:darkgreen;">Ожидаемый результат</span>

Tail для любого товара сохраняется в хранилище в момент взаимодействия пользователя с выдачей товаров и может быть использован на любом этапе e-commerce воронки (`view_item_in_list`, `view_item`, `add_to_cart`, `purchase`)

### <span style="color:darkgreen;">Технические требования</span>

Сформируйте архитектуру, которая позволит сохранять tail в момент его назначения и использовать на любом этапе e-commerce воронки.
Убедитесь, что tail передается при синхронизации товаров в корзине/избранном.
Предоставьте документацию для сервиса хранения и передачи tail.

### <span style="color:darkgreen;">Схема</span>

Ниже представлена схема того, каким образом tail может быть сформирован и сохранен на этапах e-commerce воронки

Схема:

![](https://github.com/wildberries-tech/wba_analytics_docs/blob/develop/assets/scheme.png){width=749px}

Последовательность:

![](https://github.com/wildberries-tech/wba_analytics_docs/blob/develop/assets/sequence.png){width=70%}
